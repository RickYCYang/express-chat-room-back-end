(this["webpackJsonpreact-chat-room-front-end"]=this["webpackJsonpreact-chat-room-front-end"]||[]).push([[0],{100:function(e,t){},103:function(e,t,a){},107:function(e,t,a){e.exports=a.p+"static/media/chat.36cb8b4b.png"},108:function(e,t,a){e.exports=a.p+"static/media/message.232a7059.png"},109:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(31),r=a.n(c),l=(a(71),a(6)),i=a(20),s=a(19),u=a(15),m=a(12),d=a(60),p=a(65),E=a(9),b={account:"",password:"",status:"",email:"",error:"",userName:""},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER_ACCOUNT":return Object(E.a)({},e,{account:t.payload});case"SET_USER_PASSWORD":return Object(E.a)({},e,{password:t.payload});case"LOGIN_REQUEST":return Object(E.a)({},e,{status:"loading"});case"LOGIN_SUCCESS":return Object(E.a)({},e,{status:"logined",email:t.payload.email,token:t.payload.token,userName:t.payload.userName});case"LOGIN_FAIL":return Object(E.a)({},e,{status:"error",message:t.payload.message});default:return e}},f={messageBox:[],webSocket:"",onlineCount:0,connectStatus:"",styleMessageBox:!0,isMobile:!1},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CONNECT_WEB_SOCKET":return Object(E.a)({},e,{connectStatus:"connecting"});case"CONNECT_WEB_SOCKET_SUCCESS":return Object(E.a)({},e,{connectStatus:"connected",webSocket:t.payload});case"CONNECT_WEB_SOCKET_FAIL":return Object(E.a)({},e,{connectStatus:"disconnect",webSocket:t.payload});case"SET_ONLINE_COUNT":return Object(E.a)({},e,{onlineCount:t.payload});case"SET_MESSAGE_BOX":return Object(E.a)({},e,{messageBox:e.messageBox.concat(t.payload)});case"SET_MESSAGE_BOX_STYLE":return Object(E.a)({},e,{styleMessageBox:t.payload});case"SET_IS_MOBILE":return Object(E.a)({},e,{isMobile:t.payload});default:return e}},h=function(e){return Object(m.c)({router:Object(s.b)(e),loginReducer:g,chatRoomReducer:O})},S=a(18),v=a.n(S),w=a(13),y=a(7),k=a(33),C=a.n(k),N="https://express-chat-room-back-end.herokuapp.com",_=j("token");function j(e){return C.a.get(e)}var x=function(e,t){C.a.set(e,t,{expires:7})},T=function(e){C.a.remove(e)},I=v.a.mark(B);function B(e){var t,a,n,o;return v.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,a=t.account,n=t.password,c.next=3,r={email:a,password:n},fetch(N+"/"+"login",{method:"POST",headers:{"Access-Control-Allow-Origin":"http://localhost:3001",Accept:"application/json","Content-Type":"application/json",Authorization:_},credentials:"include",body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){console.log("fetchPost",e)}));case 3:if("fail"!==(o=c.sent).status){c.next=10;break}return console.log("Fail:",o),c.next=8,Object(w.a)({type:"LOGIN_FAIL",payload:{message:o.message}});case 8:c.next=20;break;case 10:if("success"!==o.status){c.next=20;break}return console.log("success:",o),c.next=14,Object(w.a)({type:"LOGIN_SUCCESS",payload:{token:o.token,email:o.email,userName:o.userName}});case 14:return c.next=16,x("token",o.token);case 16:return c.next=18,x("userName",o.userName);case 18:return c.next=20,Object(w.a)(Object(y.d)("/"));case 20:case"end":return c.stop()}var r}),I)}var A=a(63),R=a.n(A),L=v.a.mark(U);function U(e){var t;return v.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("connectWebSocket",e),a.next=3,R()(N);case 3:if(!(t=a.sent)){a.next=9;break}return a.next=7,Object(w.a)({type:"CONNECT_WEB_SOCKET_SUCCESS",payload:t});case 7:a.next=11;break;case 9:return a.next=11,Object(w.a)({type:"CONNECT_WEB_SOCKET_FAIL"});case 11:case"end":return a.stop()}}),L)}var M=v.a.mark(W);function W(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.b)("LOGIN_REQUEST",B);case 2:return e.next=4,Object(w.b)("CONNECT_WEB_SOCKET",U);case 4:case"end":return e.stop()}}),M)}var G=Object(u.a)(),F=Object(p.a)();a(103);var P=a(8),z=a(24),q=a.n(z),D=a(27),K=a.n(D),X=a(21),J=a.n(X),Q=a(10),Y=a.n(Q),H=function(){var e=Object(l.d)(),t=Object(l.e)((function(e){return e.loginReducer})),c=t.account,r=t.password,i=t.status,s=t.message,u=j("token"),m=function(t){var a=t.currentTarget,n=a.id,o=a.value;switch(n){case"account":e({type:"SET_USER_ACCOUNT",payload:o});case"password":e({type:"SET_USER_PASSWORD",payload:o})}};Object(n.useEffect)((function(){d()}),[u]);var d=Object(n.useCallback)((function(){console.log("checkLogined",void 0!==u),u&&e(Object(y.d)("/"))}),[u]);return o.a.createElement(P.Grid,null,o.a.createElement(P.Row,null,o.a.createElement(P.Cell,{columns:3}),o.a.createElement(P.Cell,{columns:6},o.a.createElement(q.a,{id:"loginCard"},o.a.createElement(z.CardPrimaryContent,{id:"tittle"},o.a.createElement("h1",null,"Rick's Chat Room: Beta"),o.a.createElement(z.CardMedia,{id:"logoImg",square:!0,imageUrl:a(107)})),o.a.createElement(z.CardActions,{style:{display:"block"}},o.a.createElement(z.CardActionButtons,{id:"textFieldArea"},o.a.createElement(J.a,{label:"Email",className:"textField",onTrailingIconSelect:function(){e({type:"SET_USER_ACCOUNT",payload:""})},trailingIcon:o.a.createElement(Y.a,{role:"button",icon:"delete"})},o.a.createElement(X.Input,{id:"account",type:"email",value:c,onChange:m})),o.a.createElement(J.a,{label:"Password",className:"textField",onTrailingIconSelect:function(){e({type:"SET_USER_PASSWORD",payload:""})},trailingIcon:o.a.createElement(Y.a,{role:"button",icon:"delete"})},o.a.createElement(X.Input,{id:"password",type:"password",value:r,onChange:m})),o.a.createElement("div",null,o.a.createElement(K.a,{className:"loginBtn",outlined:!0,raised:!0,icon:o.a.createElement(Y.a,{role:"button",icon:"login"}),onClick:function(){e({type:"LOGIN_REQUEST",payload:{account:c,password:r}})}},"Login"),o.a.createElement(K.a,{className:"loginBtn",outlined:!0,raised:!0,disabled:!0,icon:o.a.createElement(Y.a,{role:"button",icon:"account_box"}),onClick:function(){}},"Signup")))),"error"===i?o.a.createElement("div",null,o.a.createElement("p",{className:"warnMsg"},s)):[])),o.a.createElement(P.Cell,{columns:3})))},V=a(16),$=a.n(V),Z=a(64),ee=a.n(Z),te=function(){var e,t=Object(l.e)((function(e){return e.chatRoomReducer})),a=t.messageBox,c=t.styleMessageBox,r=j("userName"),i="style-messagePanel-background",s="non-style-messagePanel-background";return Object(n.useEffect)((function(){e.scrollIntoView({behavior:"smooth"})}),[a]),o.a.createElement("div",{className:c?i:s},o.a.createElement("div",{id:"messagePanel"},a.map((function(e){return o.a.createElement(P.Row,{key:"row"+e.userName+e.timestamp},o.a.createElement(P.Cell,{columns:12},o.a.createElement("div",{className:r===e.userName?"message-box-mine":"message-box-other"},o.a.createElement(Y.a,{role:"button",icon:"account_circle",className:"account_icon"}),o.a.createElement("span",null,e.userName,"(",e.timestamp,")"),o.a.createElement("div",{className:c?r===e.userName?"style-message-mine":"style-message-other":"non-style-message"},e.message))))})),o.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e=t}})))},ae=a(44),ne=function(){var e=Object(n.useState)(""),t=Object(ae.a)(e,2),a=t[0],c=t[1],r=Object(l.e)((function(e){return e.chatRoomReducer})).webSocket,i=Object(n.useState)(!1),s=Object(ae.a)(i,2),u=s[0],m=s[1],d=j("userName");Object(n.useEffect)((function(){u&&(p(),m(!1))}));var p=function(){var e=(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+":"+(new Date).getUTCMilliseconds();r.emit("send",{userName:d,message:a,timestamp:e}),c("")},E=function(e){"Enter"===e.key&&m(!0)};return Object(n.useEffect)((function(){return r&&document.addEventListener("keypress",E),function(){document.removeEventListener("keypress",E)}}),[r]),o.a.createElement("div",{id:"messageSender"},o.a.createElement(J.a,{label:"\u4f60\u60f3\u8aaa\u4ec0\u9ebc",id:"msgTextEdit",onTrailingIconSelect:function(){return c("")},trailingIcon:o.a.createElement(Y.a,{role:"button",icon:"delete"})},o.a.createElement(X.Input,{id:"msgTextEditInput",value:a,onChange:function(e){var t=e.currentTarget.value;c(t)}})),o.a.createElement("div",{className:"wrapper-div"},o.a.createElement(K.a,{id:"msgSendBtn",outlined:!0,raised:!0,icon:o.a.createElement(Y.a,{role:"button",icon:"send"}),onClick:p},"Send")))},oe=function(){var e=Object(l.d)(),t=Object(l.e)((function(e){return e.chatRoomReducer})),c=t.webSocket,r=t.isMobile;Object(n.useEffect)((function(){c?i():e({type:"CONNECT_WEB_SOCKET"})}),[c]);var i=function(){console.log("initWebSocket"),c.on("online",(function(t){e({type:"SET_ONLINE_COUNT",payload:t})})),c.on("msg",(function(t){e({type:"SET_MESSAGE_BOX",payload:t}),document.hasFocus()||r||new Notification(t.userName,{body:t.message,icon:a(108)})}))};return o.a.createElement(P.Grid,{id:"mainGrid"},o.a.createElement(P.Row,null,o.a.createElement(P.Cell,{columns:12},o.a.createElement(te,null))),o.a.createElement(P.Row,null,o.a.createElement(P.Cell,{columns:12},o.a.createElement(ne,null))))},ce=function(){var e=Object(l.d)(),t=Object(l.e)((function(e){return e.chatRoomReducer})),a=t.onlineCount,c=t.isMobile,r=j("token"),i=j("userName");Object(n.useEffect)((function(){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&e({type:"SET_IS_MOBILE",payload:!0}),c||window.Notification&&"granted"!==Notification.permission&&Notification.requestPermission((function(e){console.log("status",e)}))}),[]),Object(n.useEffect)((function(){r||e(Object(y.d)("/login"))}),[r]);var s=Object(n.useCallback)((function(){console.log("logout"),T("token"),T("userName"),e(Object(y.d)("/login"))}),[r]);return o.a.createElement(o.a.Fragment,null,r?o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,null,o.a.createElement(V.TopAppBarRow,null,o.a.createElement(V.TopAppBarSection,{align:"start"},o.a.createElement(V.TopAppBarIcon,{navIcon:!0,tabIndex:0},o.a.createElement(Y.a,{hasRipple:!0,icon:"menu",onClick:function(){return console.log("click")}})),o.a.createElement(V.TopAppBarTitle,{tabIndex:1},"Welcome ",i,", Online People: ",a)),o.a.createElement(V.TopAppBarSection,{align:"start"},o.a.createElement(ee.a,{nativeControlId:"my-switch",checked:!0,onChange:function(t){e({type:"SET_MESSAGE_BOX_STYLE",payload:t.target.checked})}}),o.a.createElement("label",{htmlFor:"my-switch",id:"mode-switch-label"},"Style Message Box")),o.a.createElement(V.TopAppBarSection,{align:"end",role:"toolbar"},o.a.createElement(V.TopAppBarIcon,{actionItem:!0,tabIndex:0},o.a.createElement(Y.a,{"aria-label":"print page",hasRipple:!0,icon:"exit_to_app",onClick:s}))))),o.a.createElement(V.TopAppBarFixedAdjust,null,o.a.createElement(oe,null))):[])},re=function(e){var t=Object(m.e)(h(G),e,Object(m.d)(Object(m.a)(Object(d.a)(G),F)));return F.run(W),t}({}),le=function(){return o.a.createElement(l.a,{store:re},o.a.createElement(s.a,{history:G},o.a.createElement(i.c,null,o.a.createElement(i.a,{exact:!0,path:"/"},o.a.createElement(ce,null)),o.a.createElement(i.a,{exact:!0,path:"/login"},o.a.createElement(H,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(le,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},66:function(e,t,a){e.exports=a(109)},71:function(e,t,a){}},[[66,1,2]]]);
//# sourceMappingURL=main.48b09d79.chunk.js.map